### 背景与目标

#### 背景
用户在与 Cursor AI 交互时，常常因为需要切换到其他应用处理事务，而错过 AI 处理完成、出错或等待用户进一步操作的关键节点。Cursor 自带的声音提醒功能有限，尤其无法有效通知"等待用户操作"这类需要及时响应的状态，导致工作流程中断，降低了开发效率。

#### 目标
开发一款专为 macOS 用户设计的 Cursor 辅助工具，该工具由一个 VS Code 插件和一个 Menubar 应用组成。它旨在实时监控 Cursor AI 的状态，并通过系统级的通知及时告知用户，即使用户当前未聚焦于 Cursor 窗口，也能无缝衔接人机协作的每一步。

### 功能设计

本产品采用分离式架构，由两个核心组件构成，确保功能的稳定性和未来的可扩展性。

#### 组件一：VS Code 扩展（状态监听器）
- **定位**：作为植入 Cursor 的"探针"，负责数据采集。
- **核心职责**：
    -   通过监听 Cursor 聊天窗口的界面（DOM）变化，实时分析和识别 AI 的工作状态。
    -   需要识别的核心状态至少包括：处理中、已完成、等待用户操作、处理出错。
    -   将识别到的状态信息，通过本地通信机制发送给 Menubar 应用。

#### 组件二：macOS Menubar 应用（通知中心）
- **定位**：作为常驻在系统的"大脑"，负责状态处理与呈现。
- **核心职责**：
    -   在后台运行一个本地服务，接收来自 VS Code 扩展的状态数据。
    -   根据接收到的状态，调用 macOS 系统 API 发送通知。
    -   在系统菜单栏提供一个状态图标，作为 AI 当前状态的视觉指示器。

#### 组件三：通信机制（本地 HTTP API）
- **实现方式**：采用本地 HTTP 通信作为两个组件的桥梁。
- **工作流程**：
    -   Menubar 应用在本机（如 `localhost:8765`）启动一个轻量级 HTTP 服务器。
    -   VS Code 扩展作为客户端，当 AI 状态变化时，向该服务器地址发送包含状态数据的 POST 请求。
    -   **数据契约**：定义一套标准的 JSON 数据格式，用于规范通信内容，如：`{ "status": "waiting", "message": "AI 等待您的回复", "projectName": "cursor-ai-notifier" }`。

### 功能实现的阶段

为确保项目稳步推进并优先解决核心技术风险，我们将采用分阶段的开发策略。

#### 第一阶段：可行性验证 (Proof of Concept)
- **核心目标**：验证通过 VS Code 插件监听 DOM 来识别 AI 状态的技术方案是否稳定可靠。
- **主要任务**：
    1.  开发一个基础的 VS Code 扩展。
    2.  在扩展中实现对 Cursor 聊天视图的 DOM 监听。
    3.  将识别到的状态（如"正在生成"、"输入框已激活"）通过 `console.log` 输出到开发者控制台进行验证。
- **验收标准**：能够准确地在控制台打印出对应的状态日志。

#### 第二阶段：搭建通信桥梁
- **核心目标**：打通从插件到外部独立应用的数据传输链路。
- **主要任务**：
    1.  将第一阶段识别到的状态，通过 HTTP 请求发送到本地指定端口。
    2.  使用一个临时的脚本（如 Node.js 或 Python）启动一个服务来接收并打印数据，替代完整的 Menubar 应用。
- **验收标准**：临时服务端能成功接收并显示插件发送的状态数据。

#### 第三阶段：最小可行产品 (MVP)
- **核心目标**：交付一个具备核心通知功能的产品闭环。
- **主要任务**：
    1.  正式开发 macOS Menubar 应用。
    2.  在应用中内置 HTTP 服务器，并实现接收状态后的基础通知逻辑。
    3.  当收到"等待用户操作"等关键状态时，能成功弹出 macOS 系统通知。
- **验收标准**：用户可以完整体验到"在 Cursor 中操作 AI → 在 Menubar 应用中收到通知"的核心流程。

### 产品验收

#### 验收标准
1.  **状态识别准确性**：当 AI 处于"处理中"、"等待操作"、"已完成"、"出错"四种核心状态时，插件均能准确识别。
2.  **通知及时性**：在 Cursor 窗口非激活状态下，Menubar 应用能在 2 秒内收到状态变更并发出通知。
3.  **系统稳定性**：VS Code 扩展与 Menubar 应用均能稳定运行，长时间使用不应导致 Cursor 或应用本身崩溃。
4.  **资源占用**：两个组件在空闲状态下不应占用过多系统资源（CPU、内存）。
5.  **核心流程闭环**：用户能够成功安装两个组件，并在实际使用中，通过 Menubar 应用发出的通知，有效提升与 Cursor AI 的协作效率。 